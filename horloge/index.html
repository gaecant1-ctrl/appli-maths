<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Entra√Ænement ‚Äì Angle de l‚Äôhorloge</title>

<style>
body{
    margin:0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#c8fa64,#6fd6ff);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

.card{
    background:white;
    padding:30px;
    border-radius:20px;
    box-shadow:0 15px 40px rgba(0,0,0,0.2);
    text-align:center;
    width:420px;
}

h1{
    margin-top:0;
    font-size:26px;
}

.controls{
    display:flex;
    gap:10px;
    justify-content:center;
    margin-bottom:15px;
}

input[type="time"], input[type="number"]{
    padding:8px;
    border-radius:10px;
    border:1px solid #ccc;
    font-size:16px;
}

button{
    padding:8px 14px;
    border:none;
    border-radius:12px;
    font-size:16px;
    cursor:pointer;
    transition:0.2s;
}

.btn-primary{
    background:#4CAF50;
    color:white;
}

.btn-primary:hover{
    background:#3c8c41;
}

canvas{
    margin-top:15px;
}

#resultMessage{
    font-size:18px;
    font-weight:bold;
    margin-top:12px;
    min-height:28px;
    display:flex;
    align-items:center;
    justify-content:center;
}

.toggle-btn{
    width:44px;
    height:44px;
    border-radius:50%;
    border:2px solid rgba(0,0,0,0.2);
    background:rgba(255,255,255,0.4);
    backdrop-filter: blur(6px);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:20px;
    cursor:pointer;
    transition:all 0.25s ease;
    box-shadow:0 4px 10px rgba(0,0,0,0.15);
}

.toggle-btn:hover{
    transform:scale(1.08);
    background:rgba(255,255,255,0.7);
}

.toggle-btn.active{
    background:#222;
    color:white;
    border-color:#222;
}
</style>
</head>

<body>

<div class="card">
<h1>Angle entre les aiguilles</h1>

<div class="controls">
    <input type="time" id="timeInput">
    <button id="shuffleBtn" class="toggle-btn">üé≤</button>
    <button id="toggleNumbersBtn" class="toggle-btn">üëÅ</button>
</div>

<canvas id="clockCanvas" width="300" height="300"></canvas>

<form id="angleForm" class="controls" style="margin-top:15px;">
    <input type="number" id="angleInput" placeholder="Angle (¬∞)">
    <button class="btn-primary" type="submit">Valider</button>
</form>

<p id="resultMessage"></p>

</div>

<script>
const CLOCK_SCALE = 0.85;
let showNumbers = true;
let mode = "input";
let currentTotalMinutes = 0;
let animationId = null;

const canvas = document.getElementById('clockCanvas');
const ctx = canvas.getContext('2d');
const timeInput = document.getElementById("timeInput");
const shuffleBtn = document.getElementById("shuffleBtn");
const toggleBtn = document.getElementById("toggleNumbersBtn");
const resultMessage = document.getElementById("resultMessage");
const angleForm = document.getElementById("angleForm");
const angleInput = document.getElementById("angleInput");
const validateBtn = angleForm.querySelector("button");

/* ===================== ANGLES ===================== */

function getAngles(hours, minutes){
    const hourAngle = (hours % 12) * 30 + minutes * 0.5;
    const minuteAngle = minutes * 6;
    return {hourAngle, minuteAngle};
}

/* ===================== DESSIN ===================== */

function drawClock(hourAngle, minuteAngle){

    ctx.clearRect(0,0,canvas.width,canvas.height);

    let radius = canvas.height/2 * CLOCK_SCALE;

    ctx.save();
    ctx.translate(canvas.width/2, canvas.height/2);

    ctx.beginPath();
    ctx.arc(0,0,radius,0,2*Math.PI);
    ctx.fillStyle="white";
    ctx.fill();
    ctx.lineWidth=6;
    ctx.stroke();

    for(let i=0;i<12;i++){
        ctx.save();
        ctx.rotate(i * Math.PI/6);
        ctx.beginPath();
        ctx.lineWidth = 4;
        ctx.moveTo(0,-radius);
        ctx.lineTo(0,-radius*0.85);
        ctx.stroke();
        ctx.restore();
    }

    if(showNumbers){
    ctx.font = radius*0.18+"px Arial";
    ctx.textBaseline = "middle";
    ctx.textAlign = "center";
    ctx.fillStyle = "#222";

    for(let num=1; num<=12; num++){
        const angle = (num * Math.PI / 6) - Math.PI / 2;

        const x = Math.cos(angle) * radius * 0.75;
        const y = Math.sin(angle) * radius * 0.75;

        ctx.fillText(num.toString(), x, y);
    }
}

    drawHand(hourAngle * Math.PI/180, radius*0.5, 6, "#e91e63");
    drawHand(minuteAngle * Math.PI/180, radius*0.8, 4, "#2196F3");

    ctx.restore();
}

function drawHand(angle,length,width,color){
    ctx.save();
    ctx.rotate(angle);
    ctx.beginPath();
    ctx.lineWidth=width;
    ctx.lineCap="round";
    ctx.strokeStyle=color;
    ctx.moveTo(0,0);
    ctx.lineTo(0,-length);
    ctx.stroke();
    ctx.restore();
}

/* ===================== ANIMATION ===================== */

function animateToTime(targetHours, targetMinutes){

    const targetTotal = targetHours*60 + targetMinutes;

    currentTotalMinutes %= 720;
    let adjustedTarget = targetTotal <= currentTotalMinutes
        ? targetTotal + 720
        : targetTotal;

    if(animationId) cancelAnimationFrame(animationId);

    function step(){
        currentTotalMinutes += 3;

        if(currentTotalMinutes >= adjustedTarget){
            currentTotalMinutes = adjustedTarget;
        }

        const display = currentTotalMinutes % 720;
        const h = Math.floor(display/60);
        const m = display % 60;
        const angles = getAngles(h,m);

        drawClock(angles.hourAngle, angles.minuteAngle);

        if(currentTotalMinutes < adjustedTarget){
            animationId = requestAnimationFrame(step);
        }
    }

    requestAnimationFrame(step);
}

/* ===================== ACTIONS ===================== */

function updateClock(){
    const value = timeInput.value;
    if(!value) return;

    const [h,m] = value.split(":").map(Number);
    animateToTime(h,m);
}

function shuffleTime(){
    const hours = Math.floor(Math.random()*12);
    const minutesOptions = [0,10,15,20,30,40,45,50];
    const minutes = minutesOptions[Math.floor(Math.random()*minutesOptions.length)];

    timeInput.value =
        (hours<10?"0":"")+hours+":"+
        (minutes<10?"0":"")+minutes;

    animateToTime(hours,minutes);
}

function toggleNumbers(){
   
    showNumbers = !showNumbers;
    toggleBtn.classList.toggle("active");

    // Forcer un redraw imm√©diat
    const display = currentTotalMinutes % 720;
    const h = Math.floor(display / 60);
    const m = display % 60;
    const angles = getAngles(h, m);

    drawClock(angles.hourAngle, angles.minuteAngle);
}

function checkAngle(){
    if(!angleInput.value) return;

    const [h,m] = timeInput.value.split(":").map(Number);

    let diff = Math.abs(30*h - 5.5*m);
    let angle = diff > 180 ? 360-diff : diff;
    angle = Math.round(angle*10)/10;

    const student = parseFloat(angleInput.value.replace(",","."));

    if(Math.abs(student-angle) < 0.5){
        resultMessage.style.color="green";
        resultMessage.textContent="‚úÖ Bravo ! Angle = "+angle+"¬∞";
        mode="bravo";
        validateBtn.textContent="Nouvel exercice";
    }else{
        resultMessage.style.color="red";
        resultMessage.textContent="‚ùå Faux‚Ä¶ R√©essaie.";
        mode="result";
        validateBtn.textContent="Nouvel essai";
    }
}

function resetExercise(){
    resultMessage.textContent="";
    angleInput.value="";
    mode="input";
    validateBtn.textContent="Valider";
}

/* ===================== EVENTS ===================== */

shuffleBtn.addEventListener("click", shuffleTime);
toggleBtn.addEventListener("click", toggleNumbers);
timeInput.addEventListener("change", updateClock);
toggleBtn.addEventListener("click", toggleNumbers);
angleForm.addEventListener("submit", function(e){
    e.preventDefault();
    if(mode==="input") checkAngle();
    else if(mode==="bravo"){ shuffleTime(); resetExercise(); }
    else resetExercise();
});

/* ===================== INIT ===================== */

shuffleTime();
</script>

</body>
</html>